{{ define "main" }}
<link rel="stylesheet" href="/css/archive.css">

<main class="archive content">
  <p>In über {{ sub now.Year 2002 }} Jahren haben sich {{ len (where .Site.RegularPages "Type" "post") }} fabelhafte Artikel in diesem Blog angesammelt, die du hier ganz bequem durchsuchen und filtern kannst.</p>

  {{ if templates.Exists "partials/microhook-archive-lead.html" }}
    {{ partial "microhook-archive-lead.html" . }}
  {{ end }}

  <div class="archive-controls">
    <div class="search-box" style="position: relative; display: flex; align-items: center;">
      <input type="text" id="searchInput" placeholder="Suchbegriff eingeben..." style="padding-right: 3rem; flex: 1;" />
      <span id="clearSearch" style="position: absolute; right: 1rem; color: var(--accent2); cursor: pointer; font-size: 1.5rem; display: none; user-select: none;">×</span>
    </div>

    <div style="display: flex; gap: 0.5rem; margin-top: 1rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
      <button id="toggleTags" class="toggle-tags-btn">Tags ▼</button>
      <button id="toggleYears" class="toggle-tags-btn">Jahre ▼</button>
    </div>

    <div id="tagsContainer" style="display: none; margin-top: 0.5rem;"></div>

    <div id="yearsContainer" style="display: none; margin-top: 0.5rem;"></div>
  </div>

  <!-- Ergebnisliste -->
  <div id="resultsContainer" style="display: none; margin-top: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem;">
      <p id="resultsCount" style="margin: 0; color: var(--accent2);"></p>
      <a id="googleSearchLink" href="#" target="_blank" class="google-search-hint">
        <span style="display: inline-flex; align-items: center; justify-content: center; width: 1.2em; height: 1.2em; border-radius: 50%; background: var(--link); color: white; font-size: 0.8em; font-weight: bold; margin-right: 0.3em;">i</span>
        <span id="googleSearchText"></span> ↗
      </a>
    </div>
    <ul id="resultsList" style="list-style: none; padding: 0;"></ul>
  </div>

  <!-- Versteckte Datenquelle -->
  <div id="postsData" style="display: none;">
    {{ $posts := where .Site.RegularPages "Type" "post" }}
    {{ range $p := $posts }}
      {{ $titleOrSummary := cond (gt (len $p.Title) 0) $p.Title ($p.Summary | plainify) }}
      {{ $cleanTitle := $titleOrSummary | plainify }}
      {{ $tags := "" }}
      {{ with $p.Params.tags }}
        {{ $tags = delimit . "," }}
      {{ else }}
        {{ with $p.Params.categories }}
          {{ $tags = delimit . "," }}
        {{ end }}
      {{ end }}
      <div class="post-data"
           data-title="{{ $cleanTitle | lower }}"
           data-title-display="{{ $cleanTitle }}"
           data-date="{{ $p.Date.Format "2006-01-02" }}"
           data-year="{{ $p.Date.Format "2006" }}"
           data-date-display="{{ $p.Date.Format "02.01.2006" }}"
           data-time="{{ $p.Date.Format "15:04" }}"
           data-tags="{{ $tags }}"
           data-url="{{ $p.Permalink }}"></div>
    {{ end }}
  </div>
</main>

<script src="/js/archive.js"></script>
{{ end }}